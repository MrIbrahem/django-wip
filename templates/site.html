{% extends "base.html" %}
{% load staticfiles i18n %}

{% block extra_head %}
{% comment %}
<style>
    label { display: inline; font-weight: bold; margin-right: 1.0em; padding: 0.2em 0em;}
    pre { display: inline; padding: 0; }
    pre code { line-height: 0.5; }
    .l { text-align: left; }
    .r { text-align: right; }
    table { border-spacing: 10px 0; border-collapse: separate;
</style>
{% endcomment %}
{% endblock %}

{% block head_title %}Site: {{ site.name }}{% endblock %}

{% block body_id %}site{% endblock %}

{% block title-page %}WIP Site: {{ site.name }}{% endblock %}

{% block content-page %}
  <table class="table table-responsive table-bordered table-striped">
    <thead>
      <tr><th>URL</th><th>{% trans "path prefix"|capfirst %}</th><th>{% trans "allowed domains"|capfirst %}</th><th>{% trans "start urls"|capfirst %}</th>{% if site.deny %}<th>{% trans "deny"|capfirst %}</th>{% endif %}</tr>
    </thead>
    <tbody>
      <tr><td>{{ site.url }}</td><td>{{ site.path_prefix }}</td><td>{{ site.allowed_domains }}</td><td>{{ site.start_urls }}</td>{% if site.deny %}<td>{{ site.deny }}</td>{% endif %}</tr>
    </tbody>
  </table>

  <table class="table table-responsive table-bordered table-striped">
    <thead>
      <tr><th>{% trans "pages"|capfirst %}</th><th>{% trans "page blocks"|capfirst %}</th><th>{% trans "proxies"|capfirst %}</th></tr>
    </thead>
    <tbody>
      <tr>
        <td>{% if page_count %}<span class="mR10">{{ page_count }}</span><span class="mR10"><a href="/site/{{ site.slug }}/pages/" title="{% trans "list pages" %}"><i class="fa fa-th-list"></i></a></span><a href="/page/{{ first_page.id }}/" title="{% trans "browse all pages" %}"><i class="fa fa-caret-square-o-right"></i></a>{% else %}0{% endif %}</td>
        <td>{% if block_count %}<span class="mR10">{{ block_count }}</span><span class="mR10"><a href="/site/{{ site.slug }}/blocks/" title="{% trans "list blocks" %}"><i class="fa fa-th-list"></i></a></span><a href="/block/{{ first_block.id }}/" title="{% trans "browse all blocks" %}"><i class="fa fa-caret-square-o-right"></i></a>{% else %}0{% endif %}</td>
        <td>{% if proxies %}
              {% for proxy in proxies %}
                <a href="{% url 'proxy' proxy.slug %}">{{ proxy.name }}</a>{% if not forloop.last %}<br>{% endif %}
              {% endfor %}
            {% else %}
              {% trans "no proxies are available."|capfirst %}
            {% endif %}
        </td>
      </tr>
    </tbody>
  </table>

	{% if user.is_superuser %}
   	<form action="/site/{{ site.slug }}/" method="post" enctype="multipart/form-data">{% csrf_token %}
	{% if missing_languages %}
	<div>{% for l in missing_languages %}<input type="submit" name="addproxy-{{ l.code }}" value="Add {{ l.name }} proxy" class="btn btn-sm" />{% endfor %}</div>
	{% endif %}
	<div>{{ manage_form.clear_pages }} Clear all saved pages
	<input type="submit" name="site_crawl" value="{% if page_count %}Re-crawl{% else %}Crawl{% endif %}" title="scan pages" class="btn btn-sm"></div>
	<div>{{ manage_form.clear_blocks }} Clear all saved blocks
		<input type="submit" name="extract_blocks" value="Extract blocks" title="Extract" class="btn btn-sm" /></div>
	{% if not page_count and not block_count and not proxies %}
  	<div>{{ manage_form.delete_confirmation }} Yes, I am fully aware
		<input type="submit" name="delete_site" value="Delete site" title="Delete all site info" class="btn btn-sm" /></div>
	{% endif %}
	{% if page_count %}
  	<div><input type="submit" name="extract_segments" value="Extract segments" title="Extract segments" class="btn btn-sm" /></div>
	{% endif %}
  	<div>{{ manage_form.clear_invariants }} Clear invariant
  		 {{ manage_form.file }}
		<input type="submit" name="import_invariants" value="Import invariants" title="Import invariants" class="btn btn-sm" />
		<input type="submit" name="apply_invariants" value="Apply invariants" title="Mark invariant segments" class="btn btn-sm" /> (Mark invariant segments)</div>
  	<div><input type="submit" name="export_untranslated" value="Export untranslated strings" title="Export untranslated strings" class="btn btn-sm" /></div>
	{% if proxies %}
  	<div><input type="submit" name="guess_blocks_language" value="Guess blocks' language" title="Guess blocks' language" class="btn btn-sm" /></div>
	{% endif %}
	</form>
	{% endif %}

  <h4>{% trans "translation state of site pages"|capfirst %}</h4>
  <table class="table table-responsive table-bordered table-striped">
    <thead>
      <tr>
        <th>{% trans "proxy"|capfirst %}</th>
        <th>{% trans "total"|upper %}</th>
        <th>{% trans "invariant" %}</th>
        <th>{% trans "partially translated" %}</th>
        <th>{% trans "translated" %}</th>
        <th>{% trans "revised" %}</th>
        <th>{% trans "to be translated" %}</th>
      </tr>
    </thead>
    <tbody>
    {% for language, dict in pages_proxy_list %}
      <tr>
        <td><a href="/page/{{ page.id }}/proxy/{{ language.code }}/">{{ language.name }}</a></td>
        <td>{{ pages_total }}</td>
        <td><span class="mR10">{{ pages_invariant }}</span>{% if pages_invariant %}<a href="/page/0/?site={{ site.slug }}&filter=no_translate" title="{% trans "browse invariant pages" %}"><i class="fa fa-caret-square-o-right"></i></a>{% endif %}</td>
        <td>{{ dict.partially }}</td>
        <td>{{ dict.translated }}</td>
        <td>{{ dict.revised }}</td>
        <td>{{ dict.left }}</td>
      </tr>
    {% endfor %}
    </tbody>
  </table>

  <h4>{% trans "translation state of site blocks"|capfirst %}</h4>
  <table class="table table-responsive table-bordered table-striped mB0">
    <thead>
      <th>{% trans "proxy"|capfirst %}</th>
      <th>{% trans "total"|upper %}</th>
      <th>{% trans "invariant" %}</th>
      <th>{% trans "in target language" %}</th>
      <th>{% trans "partially translated" %}</th>
      <th>{% trans "translated" %}</th>
      <th>{% trans "revised" %}</th>
      <th>{% trans "to be translated" %}</th>
    </thead>
    <tbody>
    {% for language, dict in blocks_proxy_list %}
      <tr>
        <td><a href="/page/{{ page.id }}/proxy/{{ language.code }}/">{{ language.name }}</a></td>
        <td>{{ blocks_total }}</td>
        <td><span class="mR10">{{ blocks_invariant }}</span>{% if blocks_invariant %}<a href="/block/0/?site={{ site.slug }}&filter=no_translate" title="{% trans "browse invariant blocks" %}"><i class="fa fa-caret-square-o-right"></i></a>{% endif %}</td>
        <td><span class="mR10">{{ dict.already }}</span>{% if dict.already %}<a href="/block/0/?site={{ site.slug }}&filter=already&lang={{ language.code }}" title="{% trans "browse blocks already in target language" %}"><i class="fa fa-caret-square-o-right"></i></a>{% endif %}</td>
        <td>{{ dict.partially }}</td>
        <td>{{ dict.translated }}</td>
        <td>{{ dict.revised }}</td>
        <td>{{ dict.left }}</td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
{% endblock %}
